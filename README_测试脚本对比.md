# 测试脚本使用指南

## 两个测试脚本对比

| 项目 | 训练集测试 | 测试集测试 |
|-----|-----------|-----------|
| **脚本名** | `test_train_dataset.py` | `captcha_test.py` |
| **测试数据** | `dataset/train/` (~50000张) | `dataset/test/` (~19000张) |
| **目的** | 验证模型拟合程度 | 验证模型泛化能力 |
| **预期准确率** | 98-100% | 95-98% |
| **使用时机** | 训练完成后立即测试 | 最终评估 |
| **判断标准** | 越高越好（但不能100%） | 接近训练集准确率 |

## 快速使用

### 1️⃣ 测试训练集（验证拟合）

```bash
python test_train_dataset.py
```

**输出示例：**
```
训练集样本数: 50030
准确率: 99.45%  ← 验证模型是否充分学习
字符准确率: 99.87%
```

### 2️⃣ 测试测试集（验证泛化）

```bash
python captcha_test.py
```

**输出示例：**
```
测试集样本数: 19003
准确率: 96.07%  ← 验证模型泛化能力
字符准确率: 98.85%
```

## 结果判断

### ✅ 健康模型

```
训练集准确率: 99.45%
测试集准确率: 96.07%
差值: 3.38%

判断: ✓ 正常（轻微过拟合，可接受）
```

### ⚠️ 过拟合

```
训练集准确率: 99.95%
测试集准确率: 85.23%
差值: 14.72%

判断: ❌ 严重过拟合
建议: 增加正则化、数据增强
```

### ⚠️ 欠拟合

```
训练集准确率: 87.45%
测试集准确率: 85.23%
差值: 2.22%

判断: ❌ 严重欠拟合
建议: 增加训练轮数、调整网络架构
```

## 标准工作流程

```bash
# 步骤1: 生成数据集
python captcha_gen.py

# 步骤2: 训练模型
python captcha_train_a100_ultra_optimized.py

# 步骤3: 测试训练集（验证拟合）
python test_train_dataset.py

# 步骤4: 测试测试集（验证泛化）
python captcha_test.py

# 步骤5: 对比分析
# - 如果训练集低，继续训练
# - 如果测试集比训练集低很多，说明过拟合
# - 如果两者都高且接近，说明模型很好
```

## 当前项目结果

### 📊 实测数据

| 数据集 | 样本数 | 准确率 | 字符准确率 | 状态 |
|-------|--------|--------|-----------|------|
| **训练集** | 50030 | 待测试 | 待测试 | ⏳ 运行 test_train_dataset.py |
| **测试集** | 19003 | 96.07% | 98.85% | ✅ 已测试 |

### 🎯 预期结果

根据测试集96.07%的表现，训练集预期：

```
预期训练集准确率: 97-99%
预期字符准确率: 99-99.5%
预期状态: ✅ 健康模型
```

## 可视化输出

两个脚本都会生成可视化图表：

### 训练集测试
📁 `training_logs/train_dataset_test_YYYYMMDD_HHMMSS.png`

### 测试集测试
📁 `training_logs/test_results_YYYYMMDD_HHMMSS.png`

包含：
- 准确率饼图
- 位置错误分布
- Top 10字符混淆
- 准确率对比

## 常见问题

### Q: 为什么需要两个测试脚本？

**A:** 
- **训练集测试** → 看模型是否学会了
- **测试集测试** → 看模型能否应用到新数据

两者结合才能全面评估模型！

### Q: 哪个准确率更重要？

**A:** 
- 如果是学习/研究：两个都重要
- 如果是实际应用：**测试集准确率**更重要（代表真实性能）

### Q: 差值多少算正常？

**A:** 
- **0-2%**: 理想
- **2-5%**: 正常（可接受）
- **5-10%**: 需要注意
- **>10%**: 严重过拟合

### Q: 测试集比训练集高？

**A:** 
这种情况很少见，可能原因：
1. 测试集比训练集简单
2. 统计误差（样本量不同）
3. 测试集部分样本在训练时见过（数据泄露）

## 下一步

运行训练集测试查看完整结果：

```bash
python test_train_dataset.py
```

预计耗时：~2-3分钟（50000张图片，A100 GPU）

---

**快速参考：**
- 📖 详细文档：`docs/训练集测试说明.md`
- 🔧 测试集修复：`docs/测试脚本Bug修复说明.md`
- 🚀 训练优化：`docs/超大Batch训练优化说明.md`
